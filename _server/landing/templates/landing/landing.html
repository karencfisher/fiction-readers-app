<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    <style>
        body {
            align-items: center;
            font-family: Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: antiquewhite;
        }
        
        main {
            display: flex;
            flex-direction: column;
            gap: 20px;
            align-items: center;
            font-family: Verdana, sans-serif;
            padding: 10px
        }

        header {
            display: flex;
            align-items: center;
            margin: 0px 0px 10px 0px;
            padding: 10px;
            width: 100%;
            background-color: lightblue;
            height: 4rem;
        }

        h1 {
            font-size: 1.5rem;
            font-weight: normal;
            margin: 0;
        }

        h2 {
            font-size: 1.2rem;
            font-weight: normal;
            margin: 0;
        }

        .book-container {
            width: 100%;
        }

        #genres {
            display: none;
        }

        .shelf-label {
            display: flex;
            justify-content: flex-start;
            margin-top: 10px;
        }

        .books {
            display: flex;
            gap: 10px;
            align-items: center;
            max-height: 220px;
            width: 98.5%;
            border-style: solid;
            border-width: 1px;
            overflow-x: scroll;
            overflow-y: hidden;
            background-color: darkblue;
            padding: 0px 5px 0px 5px;
            border-radius: 5px;
        }

        .books img {
            max-height: 80%; 
        }

        #columns {
            width: 100%;
        }

        .registration {
            width: 100%;
            margin: 0;
        }

        .tab {
            overflow: hidden;
            border: None;
          }

        .tab button {
            background-color: #ddd;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
            border-width: 0px;
            outline: none;
            float: left;
            cursor: pointer;
            padding: 14px 16px;
            transition: 0.3s;
            font-size: 17px;
            margin: 0;
            transform: translateY(2.5px);
        }
        
        /* Change background color of buttons on hover */
        
        /* Create an active/current tablink class */
        .tab button[data-active="true"] {
            background-color: #bbb;
        }
        
        /* Style the tab content */
        .tab-content {
            padding: 6px 12px;
            background-color: #bbb;
            margin: 0;
            display: none;
            width: 95%;
            padding: 10px;
            border-bottom-left-radius: 10px;
            border-bottom-right-radius: 10px;
            border-top-right-radius: 10px;
        }

        #login-form[data-open="true"] {
            display: block;
        }

        #register-form[data-open="true"] {
            display: block;
        }

        form {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        form button {
            width: fit-content;
        }

        .field {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        input {
            width: 100%;
            align-self: center;
            flex: 1;
        }

        .eyes {
            cursor: pointer;
        }

        button {
            cursor: pointer;
        }

        #message {
            color: red;
            font-size: 1.2rem;
        }

        @media screen and (min-width: 900px) {
            body {
                display: flex;
                flex-direction: column;
                align-items: center;
                background-color: darkgray;
            }

            header {
                width: 900px;
                margin-bottom: 0px;
                border-top-left-radius: 10px;
                border-top-right-radius: 10px;
            }

            main {
                width: 900px;
                background-color: antiquewhite;
                border-bottom-left-radius: 10px;
                border-bottom-right-radius: 10px;
                padding-top: 20px;
            }

        }

        @media screen and (min-width: 768px) {
            #columns {
                display: flex;
                gap: 10px;
            }

            #blurb {
                width: 50%;
            }

            .registration {
                width: 50%;
            }

            #genres {
                display: block;
            }
        }
        
    </style>
</head>
    
<body>
    <header>
        <h1>Fiction Reader's Place</h1>
    </header>
    <main>
        <div class="book-container">
            <div class="shelf-label">
                Books read by our members
            </div>
            <div class="books" id="reader-choices"></div>
        </div>
        <script>
            const bookShelf = document.getElementById("reader-choices");
            addEventListener("load", async () => {
                const result = await fetch("/books/reader_logs");
                const books = await result.json();
                for (book of books.data) {
                    const cover = document.createElement("img");
                    cover.src = book.cover_link;
                    bookShelf.appendChild(cover);
                }
            });
        </script>

        <div id="columns">
            <div id="blurb">
                <p>
                    <b>Welcome</b> to our cozy corner of the internet, where stories come to life! 
                    Dive into a world of imagination and adventure, and discover the joy of 
                    reading. Whether you're a seasoned bookworm or just starting your literary 
                    journey, this is the perfect place to get excited about the stories that 
                    await you. Join us and let your next great read begin here!
                </p>
                <p>
                    Explore our extensive library to discover new books that pique your interest. 
                    Keep track of what you’ve read, what you’re currently diving into, and what’s 
                    next on your reading list. Plus, read reviews and recommendations from fellow 
                    members to help you find your next favorite story. Join us in celebrating the 
                    love of reading and sharing our literary adventures together!
                </p>
            </div>

            <div class="registration">
                <div class="tab">
                    <button class="tablinks" id="login" data-active="true">Login</button>
                    <button class="tablinks" id="register" data-active="false">Register</button>
                </div>
                <div id="login-form" class="tab-content" data-open="true">
                    <form action="/landing/sign_in/" method="post">
                        {% csrf_token %}
                        <div class="field">
                            <label for="username">Username</label>
                            <input type="text" id="username" name="username" value="{{ username }}">
                        </div>
                        <div class="field">
                            <label for="password">Password</label>
                            <input type="password" id="password" name="password" value="{{ password }}">
                            <span class="material-icons-outlined eyes">visibility_off</span>
                        </div>
                        <button>Sign In</button>
                    </form>
                </div>
                <div id="register-form" class="tab-content" data-open="false">
                    <form action="/landing/sign_up/" method="post">
                        {% csrf_token %}
                        <div class="field">
                            <label for="first_name">First Name</label>
                            <input type="text" id="first_name" name="first_name" value="{{ first_name }}">
                        </div>
                        <div class="field">
                            <label for="last_name">Last Name</label>
                            <input type="text" id="last_name" name="last_name" value="{{ last_name }}">
                        </div>
                        <div class="field">
                            <label for="user_name">Username</label>
                            <input type="text" id="user_name" name="user_name" value="{{ username }}">
                        </div>
                        <div class="field">
                            <label for="email">Email</label>
                            <input type="email" id="email" name="email" value="{{ email }}">
                        </div>
                        <div class="field">
                            <label for="pass_word">Password</label>
                            <input type="password" id="pass_word" name="pass_word" value="{{ password }}">
                            <span class="material-icons-outlined eyes">visibility_off</span>
                        </div>
                        <button>Create Account</button>
                        </form>
                </div>
                <script>
                    let tab = "login";
                    const loginTab = document.getElementById("login");
                    const loginForm = document.getElementById("login-form")
                    const registerTab = document.getElementById("register");
                    const registerForm = document.getElementById("register-form");
                    const tabLinks = [...document.getElementsByClassName("tablinks")];
                    tabLinks.forEach((item) => {
                        item.addEventListener("click", () => {
                            if (tab === "registration") {
                                loginTab.dataset.active = "true";
                                loginForm.dataset.open = "true";
                                registerTab.dataset.active = "false";
                                registerForm.dataset.open = "false";
                                tab = "login";
                            }
                            else {
                                loginTab.dataset.active = "false";
                                loginForm.dataset.open = "false";
                                registerTab.dataset.active = "true";
                                registerForm.dataset.open = "true";
                                tab = "registration";
                            }
                        });
                    });

                    const eyes = [...document.getElementsByClassName("eyes")];
                    eyes.forEach((item) => {
                        item.addEventListener("click", (e) => {
                            const textField = e.target.previousElementSibling;
                            if (e.target.innerText === "visibility_off") {
                                e.target.innerText = "visibility";
                                textField.setAttribute("type", "text");
                            }
                            else {
                                e.target.innerText = "visibility_off";
                                textField.setAttribute("type", "password");
                            }
                        });
                    });
                </script>
            </div>
            <div id="message">{{ message }}</div>
        </div>

        <div class="book-container" id="genres"></div>
        <script>
            const genreShelves = document.getElementById("genres");
            addEventListener("load", async () => {
                const result = await fetch("/books/genres");
                const genres = await result.json();
                for (genre of genres.data) {
                    const label = document.createElement("div");
                    label.classList.add("shelf-label");
                    label.innerText = genre.genre;
                    genreShelves.appendChild(label);
                    const shelf = document.createElement("div");
                    shelf.classList.add("books");
                    for (book of genre.books) {
                        const cover = document.createElement("img");
                        cover.src = book.cover_link;
                        shelf.appendChild(cover);
                    }
                    genreShelves.appendChild(shelf);
                }
            });
        </script>
    </main>
</body>
